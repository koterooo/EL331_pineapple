<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>KWIC Explorer (JS + compromise)</title>
  <script src="https://unpkg.com/compromise@14.0.0/builds/compromise.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .highlight { background: #fffa65; font-weight: bold; }
    pre { background: #f4f4f4; padding: .5rem; }
  </style>
</head>
<body>
  <h1>KWIC Explorer</h1>
  <textarea id="text" rows="6" style="width:100%">A banana is an elongated, edible fruit that…</textarea><br>
  <input id="target" placeholder="検索語 (例: banana)" value="banana">
  <input id="window" type="number" value="5" style="width:4em;"> words　
  <button id="run">Run</button>
  <hr>
  <pre id="output"></pre>

  <script>
    const nlp = window.nlp;
    function kwic(text, target, windowSize) {
      // トークン化
      const doc = nlp(text);
      const terms = doc.terms().out('array');  // e.g. ["A","banana","is",…]
      const lowerTarget = target.toLowerCase();
      let html = '';

      for (let i = 0; i < terms.length; i++) {
        if (terms[i].toLowerCase() === lowerTarget) {
          const left  = terms.slice(Math.max(0, i-windowSize), i).join(' ');
          const mid   = `<span class="highlight">${terms[i]}</span>`;
          const right = terms.slice(i+1, i+1+windowSize).join(' ');
          // 左を右寄せ、中央を中央寄せ、右を左寄せ
          html += left.padStart(40) + '  ' + mid.padEnd(target.length+4) + '  ' + right + '\n';
        }
      }
      return html || 'No matches found.';
    }

    document.getElementById('run')
      .addEventListener('click', () => {
        const text = document.getElementById('text').value;
        const target = document.getElementById('target').value;
        const windowSize = parseInt(document.getElementById('window').value, 10);
        document.getElementById('output').textContent = kwic(text, target, windowSize);
      });
  </script>
</body>
</html>
